<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>spider | Fool&#39;s router</title>
  <meta name="author" content="lee">
  
  <meta name="description" content="diary of a fool">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="spider"/>
  <meta property="og:site_name" content="Fool&#39;s router"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Fool&#39;s router" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Fool&#39;s router</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2018-02-23T10:39:27.000Z"><a href="/2018/02/23/spider/">2018-02-23</a></time>
      
      
  
    <h1 class="title">spider</h1>
  

    </header>
    <div class="entry">
      
        <p>request 对象常用属性<br>r.status_code<br>r.text<br>r.encoding<br>r.apparent_encoding<br>r.content</p>
<p>request 异常<br>requests.ConnectionError<br>requests.HTTPError<br>requests.URLRequired<br>requests.TooManyRedirects<br>requests.ConnectTimeout<br>requests.Timeout</p>
<p>r.raise_for_status()</p>
<p>http 协议对资源的操作<br>get<br>head<br>post<br>put<br>patch<br>delete</p>
<p>requests.requesr(method,url,<strong>kwargs)
</strong>kwargs 控制访问参数 均可选<br>params  data json headers cookies auth files timeout<br>proxies allow_redirects stream verify cert </p>
<p>from bs4 import BeautifulSoup<br>soup = BeautifulSoup(‘</p><p>data</p><p>‘,’html.parser’)<br>解析器 lxml xml html5lib </p>
<p>urllib 库<br>//获取网页<br>r=urllib.request.urlopen()<br>r.read().decode(‘utf-8)<br>//编码文字 post方法访问<br>data = bytes(urllib.parse.urlencode({‘word’:’hello’}),encoding=’utf-8’)<br>r = urllib.request.urlopen(‘<a href="http://httpbin.org/post&#39;,data" target="_blank" rel="external">http://httpbin.org/post&#39;,data</a> =data)</p>
<p>//timeout  超时  单位 秒<br>import socket<br>import urllib.request<br>import urllib.error</p>
<p>try:<br>    r = urllib.request.urlopen(‘<a href="http://httpbin.org/get&#39;,timeout=0.1" target="_blank" rel="external">http://httpbin.org/get&#39;,timeout=0.1</a>)<br>except urllib.error.URLError as e :<br>    if isinstance(e.reason,socker.timeout):<br>        print(‘TIMEOUT’)</p>
<p>//request<br>url = ‘h…..’<br>dict = {<br>    ‘name’:’Germey’<br>}<br>data = bytes(parse.urlencode(dict),encoding=’utf-8’)<br>req = request.Request(url=rul,data=data,method=’POST’)<br>r = request.urlopen(req)</p>
<p>//代理</p>
<p>proxy_handler = urllib.request.ProvyHandler({<br>    ‘http’:’<a href="http://127.0.0.1:9743" target="_blank" rel="external">http://127.0.0.1:9743</a>‘,<br>    ‘https’:’<a href="https://127.0.0.1:9743" target="_blank" rel="external">https://127.0.0.1:9743</a>‘<br>})<br>opener = urllib.request.build_opener(proxy_handler)<br>response = opener.open(‘<a href="http://www.baidu.com" target="_blank" rel="external">http://www.baidu.com</a>‘)</p>
<p>//cookie<br>//获取COOKIE<br>import http.cookiejar,urllib.request<br>cookie = http.cookiejar.CookieJar()<br>handler = urllib.request.HTTPCookieProcessor(cookie)<br>opener = urllib.request.build_opener(handler)<br>response = opener.open(‘<a href="http://www.baidu.com" target="_blank" rel="external">http://www.baidu.com</a>‘)<br>for item in cookie:<br>print(item.name+’=’+item.valir)<br>//文件保存cookie<br>import http.cookiejar,urllib.request<br>filename=’cookie.txt’<br>cookie=http.cookiejar.MozillaCookie.Jar(filename)<br>handler=urlliv.request.HTTPCookieProcessor(cookie)<br>opener=urllib.request.build_opener(handler)<br>response=opener.open(‘<a href="http://www.baidu.com" target="_blank" rel="external">http://www.baidu.com</a>‘)<br>cookie.save(ignore_discard=True,ignore_expires=True)</p>
<p>import http.cookiejar,urllib.request<br>filename=’cookie.txt’<br>cookie=http.cookiejar.LWPCookieJar(filename)<br>handler=urlliv.request.HTTPCookieProcessor(cookie)<br>opener=urllib.request.build_opener(handler)<br>response=opener.open(‘<a href="http://www.baidu.com" target="_blank" rel="external">http://www.baidu.com</a>‘)<br>cookie.save(ignore_discard=True,ignore_expires=True)</p>
<p>//文件读取<br>import http.cookiejar,urllib.request<br>cookie= http.cookiejar.LWPCookie.Jar()<br>cookie.load(‘cookie.txt,ignore_discard = True,ignore_expires=True)<br>handler = urllib.request.HTTPCookieProcessor(cookie)<br>opener = urllib.request.build_opener(handler)<br>response = opener.open(‘<a href="http://www.baidu.com" target="_blank" rel="external">http://www.baidu.com</a>‘)<br>print(response.read().decod(‘utf-8))</p>
<p>###异常处理<br>from urllib import request,error<br>try:<br>    response = request.urlopen(‘<a href="http://sdadad" target="_blank" rel="external">http://sdadad</a>‘)<br>except error.URLEroor as e:<br>    print(e.reason)</p>
<p>###URL解析<br>from urlliv.parse import urlparse<br>result = urlparse(‘httdasdsadsada’)<br>print(resuel)</p>
<h3 id="URL-合成"><a href="#URL-合成" class="headerlink" title="URL 合成"></a>URL 合成</h3><p>from urllib.parse import urlunparse<br>data = [‘http’,’www.baidu.com’.’index.html’,’user’,’a=6’,’comment’]<br>print(urlunparse(data))</p>
<p>###拼接 URL<br>from urllib.parse import urljoin<br>urljoin(‘<a href="http://www.baidu.com&#39;,&#39;FAQ.html" target="_blank" rel="external">http://www.baidu.com&#39;,&#39;FAQ.html</a>‘)</p>
<h3 id="字典转URL参数"><a href="#字典转URL参数" class="headerlink" title="字典转URL参数"></a>字典转URL参数</h3><p>from urllib.parse import urlencode<br>params = {<br>    ‘name’=’germey’<br>    ‘age’:22<br>}<br>base_url = ‘<a href="http://www.baidu.com?" target="_blank" rel="external">http://www.baidu.com?</a>‘<br>url = base_url + urlencode(params)<br>print(url)</p>
<p>##request   部分</p>
<h3 id="jason"><a href="#jason" class="headerlink" title="jason"></a>jason</h3><p>r= resadas.get….//<br>r.jason</p>
<p>###文件上次<br>files = {‘file’:open(‘fasdasd.asd)’,’rb’}<br>r = request.post(‘htt……’,files=files)</p>
<p>r = request.get(‘htt..)<br>for key,value in response.cookies.items():<br>    print(..)</p>
<p>###session  获取cookie<br>s = requests.Session()<br>s.get(‘http……’)<br>r = s.get(‘http….’)</p>
<h3 id="证书验证"><a href="#证书验证" class="headerlink" title="证书验证"></a>证书验证</h3><p>r = request.get(‘https…..’,verify=False)<br>取消警告<br>from requests.packages import urllib3<br>urllib3.disable_warnings()<br>手动指定位置<br>r = requests.get(‘https…’,cert=(‘/path/server.cert’,’/path/key’))</p>
<p>###代理<br>proxies = {<br>    ‘http’:’https:user:password@127.0.0.1:9743’<br>}<br>r = requests.get(‘https:…….’,proxies=proxies)</p>
<p>###捕捉超时<br>import requests.exceptions import ReadTimeout<br>try:<br>    r = requests.get(‘h////‘,’timeout=0.5)<br>except ReadTimeout:<br>    print()</p>
<p>###认证<br>r = request.get(‘htt…..’,auth={‘user’,’123’})</p>
<p>##beautifulsoup</p>
<p>###获取属性<br>soup.p.attrs[‘name’]<br>soup.p[‘name’]</p>
<h3 id="迭代"><a href="#迭代" class="headerlink" title="迭代"></a>迭代</h3><p>soup.p.a</p>
<h3 id="子节点-列表"><a href="#子节点-列表" class="headerlink" title="子节点 列表"></a>子节点 列表</h3><p>soup.p.contents</p>
<h3 id="子节点-迭代器"><a href="#子节点-迭代器" class="headerlink" title="子节点  迭代器"></a>子节点  迭代器</h3><p>soup.p.children</p>
<h3 id="子孙迭代器"><a href="#子孙迭代器" class="headerlink" title="子孙迭代器"></a>子孙迭代器</h3><p>soup.p.descendants<br>parent parents </p>
<h3 id="兄弟节点"><a href="#兄弟节点" class="headerlink" title="兄弟节点"></a>兄弟节点</h3><p>soup.a.next_siblings<br>soup.a.previous_siblings</p>
<p>soup.find_all(attrs={‘class’:’asd’})<br>soup.fiind<em>all(calss</em>=’asdsad)</p>
<p>soup.select(标签’u li’  ID获取#1 类.class)</p>
<p>###获取属性<br>soup.select(‘ul)<br>for ul in soup.select(‘ul’):<br>    print(ul[‘id’])<br>    print(ul.attrs[‘id’])</p>
<h4 id="获取文本"><a href="#获取文本" class="headerlink" title="获取文本"></a>获取文本</h4><p>ui.get_text()</p>
<p>#selenium 部分</p>
<p>###声明浏览器对象<br>from selenium import webdriver<br>browser = webdriver.Chrome()<br>browser = webdriver.FIREFOX()<br>browser = webdriver.Edge()<br>browser = webdriver.PhantomJS()<br>browser = webdriver.Safari()</p>
<p>###访问页面<br>browser = webdriver.Chrome()<br>browser.get(‘httt……’)<br>print(browser.page_source)<br>browser.close()</p>
<p>###查找元素<br>browser.find_element_by_id(‘1)<br>browser.find_element_by_naem<br>browser.find_element_by_xpath<br>browser.find_element_by_link_text<br>browser.find_element_by_partial_link_text<br>browser.find_element_by_tag_name<br>browser.find_element_by_class_name<br>browser.find_element_by_css_selector</p>
<p>browser.find_element(By.ID,’q’)</p>
<p>###多个元素<br>browser.find_elements<em>by</em><em>*</em></p>
<p>###元素交互<br>browser = webdriver.Chrome()<br>browser.get(‘<a href="https://www.taobao.com" target="_blank" rel="external">https://www.taobao.com</a>‘)<br>input = browser.find_element_by_id(‘q’)<br>input.send_keys(‘iPhone’)<br>time.sleep(1)<br>input.clear()<br>input.send_keys(‘Ipad’)<br>button = browser.find_element_by_class_name(‘bin-search’)<br>button.click()</p>
<p>###交互动作<br>from selenium import webdriver<br>from selenium.webdriver import ActionChains</p>
<p>browser = webdriver.Chrome()<br>url = ‘http//www.runoob.com/try/try.php?filename=jqueryui-api-droppable’<br>browser.get(url)<br>browser.switch_to.frame(‘iframeResult)<br>source = browser/find_element_by_css_selector(‘#draggable’)<br>target = browser.find_element_by_css_selector(‘#droppable’)<br>actions = ActionChains(browser)<br>actions.drag_and_drop(source,target)<br>actions.perform()</p>
<p>###执行javascript<br>brewser.execute_script(‘window.scrollTo(0,document.body.scrollHeight)’)<br>browser.execute_script(‘alert(‘To Bottom’)’)</p>
<h3 id="获取属性"><a href="#获取属性" class="headerlink" title="获取属性"></a>获取属性</h3><p><em>*</em>.get_attribute(‘class’)</p>
<h3 id="获取文本-1"><a href="#获取文本-1" class="headerlink" title="获取文本"></a>获取文本</h3><p>input = browser.find_element_by_class_name(‘zu-top-add-question)<br>print(input.text)</p>
<h3 id="获取ID-位置-标签名-大小"><a href="#获取ID-位置-标签名-大小" class="headerlink" title="获取ID 位置 标签名 大小"></a>获取ID 位置 标签名 大小</h3><p>input.id<br>input.location<br>input.tag_name<br>input.size</p>
<h3 id="frame-切换-子frame-不能找到父frame"><a href="#frame-切换-子frame-不能找到父frame" class="headerlink" title="frame 切换   子frame 不能找到父frame"></a>frame 切换   子frame 不能找到父frame</h3><p><strong><em>.switch_to.parent_frame()
</em></strong>.switch_to.frame(‘ddd’)</p>
<p>##等待</p>
<h3 id="隐式等待"><a href="#隐式等待" class="headerlink" title="隐式等待"></a>隐式等待</h3><p>browser = webdriver.Chrome()<br>browser.implicity_wait(10)<br>browser.get(‘httt….’t)</p>
<p>###显式等待<br>from selemnium import webdriver<br>from selemnium.webdriver.common.by import By<br>from selemnium.webdriver.support.ui import WebDriverWait<br>from selemnium.webdriver.support import expected_conditions as EC<br>browser = webdriver.Chrome()<br>browser.get(‘http////‘)<br>wait = WebDriverWait(browser,10)<br>input = wait.until(EC.presence_of_element_located((By.ID,’q’)))<br>button = wait.until(EC.element_to_be_clickable((By.CSS_SELECTOR,’.btn-search’)))</p>
<p>expected_conditions:<br>title_is 标题是某内容<br>title_contains 标题包含某内容<br>presence_of_element_located 元素加载出 传入定位元祖<br>visibility_of_element_located 元素可见 传入定位元祖<br>visibility_of 可见 传入元素对象<br>presence_of_all_elements_located 所有元素加载<br>text_to_be_present_in_element 某个元素值包含某文字<br>text_to_be_present_in_element_value 某个元素值包含某值<br>frame_to_be_avaliabel_and_switch_to_it frame加载并切换<br>invisibility_of_element_located 元素不可见<br>element_to_be_clickable 元素可点击<br>staleness_of 判断一个元素是否仍在DOM 可判断页面是否已经刷新<br>element_to_be_selected 元素可选择 传元素对象<br>element_located_to_be_selected 元素可选择 传入定位元组<br>element_selection_state_to_be 传入元素对象以及状态 相等返回True 否则 False<br>element_selection_state_to_be 传入定位元祖以及状态 相等 True 否 False<br>alert_is_present 是否出现Alert</p>
<p>###前进 后退<br>browser.back()<br>browser.forward()</p>
<h3 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h3><p>browser.add_cookie()<br>browser.delete_all_cookies()</p>
<p>###网页选项卡<br>browser.execute_script(‘window.open()’)</p>
<p>browser.switch_to_window(browser.window_handles[1])<br>browser.switch_to_window(browser.window_handles[0])</p>

      
    </div>
    <footer>
      
        
        
        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">Comments</h1>

  
      <div id="fb-root"></div>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=123456789012345";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

<div class="fb-comments" data-href="http://yoursite.com/2018/02/23/spider/index.html" data-num-posts="5" data-width="840" data-colorscheme="light"></div>
      
  
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:yoursite.com">
  </form>
</div>

  

  
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2018 lee
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>
